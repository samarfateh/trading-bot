<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Strategy Lab: AI Consultant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Outfit', sans-serif;
            background-color: #050505;
            color: #e5e5e5;
        }

        .text-trade-up {
            color: #00ff9d;
            text-shadow: 0 0 20px rgba(0, 255, 157, 0.4);
        }

        .text-trade-down {
            color: #ff3b30;
            text-shadow: 0 0 20px rgba(255, 59, 48, 0.4);
        }

        .bg-dark-panel {
            background: #0a0a0a;
        }

        .bg-dark-card {
            background: #111;
        }

        .animate-pulse-slow {
            animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: .7;
            }
        }

        .fade-enter-active,
        .fade-leave-active {
            transition: opacity 0.2s ease;
        }

        .fade-enter-from,
        .fade-leave-to {
            opacity: 0;
        }
    </style>
    <style>
        /* Anti-Scraping / Obfuscation */
        body {
            -webkit-user-select: none;
            /* Safari */
            -ms-user-select: none;
            /* IE 10+ */
            user-select: none;
            /* Standard syntax */
        }
    </style>
    <script>
        // Best Effort Code Protection
        document.addEventListener('contextmenu', event => event.preventDefault());

        document.onkeydown = function (e) {
            // Disable F12, Ctrl+Shift+I, Ctrl+Shift+J, Ctrl+U
            if (event.keyCode == 123) return false;
            if (e.ctrlKey && e.shiftKey && e.keyCode == 'I'.charCodeAt(0)) return false;
            if (e.ctrlKey && e.shiftKey && e.keyCode == 'J'.charCodeAt(0)) return false;
            if (e.ctrlKey && e.keyCode == 'U'.charCodeAt(0)) return false;
        }

        // Console Warning
        console.log("%cSTOP!", "color: red; font-size: 50px; font-weight: bold;");
        console.log("%cThis is a browser feature intended for developers. Access is restricted.", "font-size: 20px;");
    </script>
</head>

<body class="h-screen overflow-hidden flex flex-col">
    <div id="app" class="h-full flex flex-col">

        <!-- Header: The Cockpit -->
        <header class="flex flex-col px-6 py-4 border-b border-gray-900 bg-black/50 backdrop-blur-md z-10 gap-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="w-3 h-3 rounded-full bg-green-500 animate-pulse box-shadow-green"></div>
                    <div>
                        <h1 class="text-2xl font-black tracking-tight flex items-center gap-2">
                            AMD <span class="text-gray-600 font-thin">|</span> <span
                                :class="change >= 0 ? 'text-green-500' : 'text-red-500'">${{ price.toFixed(2) }}</span>
                            <span class="text-sm px-2 py-0.5 rounded bg-gray-900"
                                :class="change >= 0 ? 'text-green-400' : 'text-red-400'">{{ formatChange(change)
                                }}</span>
                        </h1>
                    </div>
                </div>

                <!-- Tabs -->
                <nav class="flex gap-1 bg-gray-900 p-1 rounded-lg">
                    <button @click="activeTab = 'CONSULTANT'"
                        :class="{'bg-gray-800 text-white shadow': activeTab === 'CONSULTANT', 'text-gray-500': activeTab !== 'CONSULTANT'}"
                        class="px-5 py-2 rounded-md text-sm font-bold transition-all">Consultant</button>
                    <button @click="activeTab = 'PORTFOLIO'"
                        :class="{'bg-gray-800 text-white shadow': activeTab === 'PORTFOLIO', 'text-gray-500': activeTab !== 'PORTFOLIO'}"
                        class="px-5 py-2 rounded-md text-sm font-bold transition-all">Portfolio</button>
                    <button @click="activeTab = 'HISTORY'"
                        :class="{'bg-gray-800 text-white shadow': activeTab === 'HISTORY', 'text-gray-500': activeTab !== 'HISTORY'}"
                        class="px-5 py-2 rounded-md text-sm font-bold transition-all">History</button>
                    <button @click="activeTab = 'BRAIN'"
                        :class="{'bg-gray-800 text-white shadow': activeTab === 'BRAIN', 'text-gray-500': activeTab !== 'BRAIN'}"
                        class="px-5 py-2 rounded-md text-sm font-bold transition-all">Logic Log</button>
                </nav>
            </div>

            <!-- Vitals Strip -->
            <div class="flex items-center gap-6 text-xs font-mono text-gray-500 overflow-x-auto pb-2">
                <div class="flex flex-col">
                    <span class="uppercase text-[10px] tracking-widest text-gray-600">Panic Level</span>
                    <span class="font-bold text-sm" :class="getPanicColor(panicLevel)">{{ panicLevel }}</span>
                </div>
                <div class="w-px h-8 bg-gray-800"></div>
                <div class="flex flex-col">
                    <span class="uppercase text-[10px] tracking-widest text-gray-600">Day High</span>
                    <span class="font-bold text-white text-sm">${{ dayHigh }}</span>
                </div>
                <div class="flex flex-col">
                    <span class="uppercase text-[10px] tracking-widest text-gray-600">Day Low</span>
                    <span class="font-bold text-white text-sm">${{ dayLow }}</span>
                </div>
                <div class="w-px h-8 bg-gray-800"></div>
                <div class="flex flex-col">
                    <span class="uppercase text-[10px] tracking-widest text-gray-600">Volume</span>
                    <span class="font-bold text-white text-sm">{{ formatVol(volume) }}</span>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="flex-1 relative overflow-hidden p-6 max-w-5xl mx-auto w-full">

            <transition name="fade" mode="out-in">

                <!-- TAB 1: AI CONSULTANT -->
                <div v-if="activeTab === 'CONSULTANT'" key="consultant" class="h-full flex flex-col gap-6">
                    <!-- The Verdict Banner -->
                    <div
                        class="w-full bg-dark-panel border border-gray-800 rounded-xl p-6 text-center animate-pulse-slow">
                        <div class="text-xs text-blue-400 font-bold mb-2 uppercase tracking-widest">The Judge's Verdict
                        </div>
                        <div class="text-2xl font-medium text-white max-w-3xl mx-auto leading-relaxed">
                            "{{ currentVerdict }}"
                        </div>
                    </div>

                    <!-- Best Bet Card -->
                    <div v-if="bestBet" class="flex-1 flex items-center justify-center">
                        <div
                            class="bg-dark-card border border-gray-800 rounded-2xl p-8 max-w-md w-full text-center relative overflow-hidden group hover:border-gray-700 transition-colors">
                            <div
                                class="absolute inset-0 bg-gradient-to-b from-transparent to-black/50 pointer-events-none">
                            </div>

                            <div class="relative z-10">
                                <span
                                    class="bg-blue-500/10 text-blue-400 px-3 py-1 rounded-full text-xs font-bold mb-4 inline-block">RECOMMENDED
                                    STRATEGY</span>
                                <h2 class="text-4xl font-black mb-1"
                                    :class="bestBet.direction === 'BULLISH' ? 'text-trade-up' : 'text-trade-down'">{{
                                    bestBet.strategy_name }}</h2>
                                <p class="text-gray-400 text-sm mb-6">{{ bestBet.direction }} on AMD</p>

                                <div class="grid grid-cols-2 gap-4 text-left">
                                    <div class="bg-black/40 rounded-lg p-3">
                                        <div class="text-xs text-gray-500">Trust Score</div>
                                        <div class="text-xl font-bold text-white">{{ bestBet.prediction ?
                                            bestBet.prediction.confidence : 0 }}%</div>
                                    </div>
                                    <div class="bg-black/40 rounded-lg p-3">
                                        <div class="text-xs text-gray-500">Target</div>
                                        <div class="text-xl font-bold text-white">${{ bestBet.prediction ?
                                            bestBet.prediction.target_price : 0 }}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div v-else class="flex-1 flex items-center justify-center text-gray-600">
                        <div class="text-center">
                            <i class="ph-duotone ph-scan text-4xl mb-4"></i>
                            <p>Scanning Market...</p>
                        </div>
                    </div>
                </div>

                <!-- TAB 3: PORTFOLIO -->
                <div v-else-if="activeTab === 'PORTFOLIO'" key="portfolio" class="h-full flex flex-col gap-6">
                    <!-- Stats Header -->
                    <div class="grid grid-cols-3 gap-4">
                        <div class="bg-dark-panel border border-gray-800 rounded-xl p-4">
                            <div class="text-xs text-gray-500 uppercase">Total P&L</div>
                            <div class="text-2xl font-bold"
                                :class="portfolio.total_pnl >= 0 ? 'text-green-400' : 'text-red-400'">
                                ${{
                                portfolio.total_pnl }}</div>
                        </div>
                        <div class="bg-dark-panel border border-gray-800 rounded-xl p-4">
                            <div class="text-xs text-gray-500 uppercase">Win Rate</div>
                            <div class="text-2xl font-bold text-white">{{ portfolio.win_rate }}%</div>
                        </div>
                        <div class="bg-dark-panel border border-gray-800 rounded-xl p-4">
                            <div class="text-xs text-gray-500 uppercase">Active Trades</div>
                            <div class="text-2xl font-bold text-blue-400">{{ portfolio.open_trades.length }}</div>
                        </div>
                    </div>

                    <!-- Active Trades List -->
                    <div class="flex-1 overflow-hidden flex flex-col gap-4">
                        <!-- Open -->
                        <div class="bg-dark-panel border border-gray-800 rounded-xl overflow-hidden flex-shrink-0">
                            <div
                                class="bg-gray-900/50 p-3 text-xs font-bold text-gray-500 uppercase border-b border-gray-800">
                                Open Positions</div>
                            <div class="p-4 space-y-3 max-h-48 overflow-y-auto">
                                <div v-for="trade in portfolio.open_trades" :key="trade.id"
                                    class="flex items-center justify-between p-3 bg-dark-card rounded-lg border border-gray-800">
                                    <div>
                                        <div class="font-bold text-white">{{ trade.strategy_id }}</div>
                                        <div class="text-xs text-gray-500">{{ trade.entry_date }} @ ${{
                                            trade.entry_price }}</div>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-sm font-bold"
                                            :class="trade.direction === 'BULLISH' ? 'text-green-500' : 'text-red-500'">
                                            {{ trade.direction }}</div>
                                    </div>
                                </div>
                                <div v-if="portfolio.open_trades.length === 0" class="text-center text-gray-600 py-4">
                                    No active trades. Scanning...
                                </div>
                            </div>
                        </div>

                        <!-- Lesson History -->
                        <div
                            class="bg-dark-panel border border-gray-800 rounded-xl overflow-hidden flex-1 flex flex-col">
                            <div
                                class="bg-gray-900/50 p-3 text-xs font-bold text-blue-400 uppercase border-b border-gray-800 flex items-center gap-2">
                                <i class="ph-bold ph-student"></i> Theory Check (Recent Lessons)
                            </div>
                            <div class="p-4 space-y-3 overflow-y-auto">
                                <div v-for="hist in portfolio.history" :key="hist.id"
                                    class="p-3 bg-dark-card rounded-lg border border-gray-800">
                                    <div class="flex justify-between mb-2">
                                        <div class="font-bold text-white">{{ hist.strategy_id }}</div>
                                        <div :class="hist.pnl >= 0 ? 'text-green-400' : 'text-red-400'">{{ hist.pnl >= 0
                                            ? '+' : '' }}${{ hist.pnl ? hist.pnl.toFixed(2) : '0.00' }}</div>
                                    </div>
                                    <div
                                        class="text-sm bg-blue-500/10 text-blue-300 p-2 rounded flex gap-2 items-start">
                                        <i class="ph-fill ph-lightbulb mt-0.5"></i>
                                        <span>{{ hist.lesson || "Analysis Pending..." }}</span>
                                    </div>
                                </div>
                                <div v-if="!portfolio.history || portfolio.history.length === 0"
                                    class="text-center text-gray-600 py-4">
                                    No history yet. Learning in progress...
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- TAB 3.5: HISTORY LAB -->
                <div v-else-if="activeTab === 'HISTORY'" key="history" class="h-full flex flex-col gap-6">
                    <!-- Stats Header -->
                    <div class="grid grid-cols-3 gap-4">
                        <div class="bg-dark-panel border border-gray-800 rounded-xl p-4">
                            <div class="text-xs text-gray-500 uppercase">Historical Decisions</div>
                            <div class="text-2xl font-bold text-white">{{ backtestStats.total_decisions || 0 }}</div>
                        </div>
                        <div class="bg-dark-panel border border-gray-800 rounded-xl p-4">
                            <div class="text-xs text-gray-500 uppercase">Best Strategy</div>
                            <div class="text-sm font-bold text-green-400">{{ backtestStats.strategies &&
                                backtestStats.strategies[0]
                                ? backtestStats.strategies[0].name : 'N/A' }}</div>
                            <div class="text-xs text-gray-400">{{ backtestStats.strategies &&
                                backtestStats.strategies[0] ?
                                backtestStats.strategies[0].win_rate : 0 }}% wins</div>
                        </div>
                        <div class="bg-dark-panel border border-gray-800 rounded-xl p-4">
                            <div class="text-xs text-gray-500 uppercase">Market Regimes Seen</div>
                            <div class="text-2xl font-bold text-white">{{ Object.keys(backtestStats.regimes ||
                                {}).length }}</div>
                        </div>
                    </div>

                    <!-- Timeline View -->
                    <div class="flex-1 overflow-hidden flex flex-col bg-dark-panel border border-gray-800 rounded-xl">
                        <div
                            class="bg-gray-900/50 p-3 text-xs font-bold text-purple-400 uppercase border-b border-gray-800 flex items-center gap-2">
                            <i class="ph-bold ph-clock-clockwise"></i> Time Machine (Last 50 Decisions)
                        </div>
                        <div class="p-4 overflow-y-auto space-y-2">
                            <div v-for="decision in backtestHistory" :key="decision.timestamp"
                                class="flex items-center gap-3 p-3 bg-dark-card rounded-lg border border-gray-800 hover:border-gray-700 transition-colors">
                                <!-- Date -->
                                <div class="text-xs text-gray-500 w-24">{{ formatDate(decision.timestamp) }}</div>

                                <!-- Outcome Indicator -->
                                <div class="flex-shrink-0">
                                    <div v-if="decision.outcome_7d > 0" class="w-3 h-3 rounded-full bg-green-500"></div>
                                    <div v-else class="w-3 h-3 rounded-full bg-red-500"></div>
                                </div>

                                <!-- Strategy & Details -->
                                <div class="flex-1">
                                    <div class="flex items-center gap-2">
                                        <span class="font-bold text-white text-sm">{{ decision.recommended_strategy ||
                                            'No Signal'
                                            }}</span>
                                        <span v-if="decision.strategy_direction" class="text-xs px-2 py-0.5 rounded"
                                            :class="decision.strategy_direction === 'BULLISH' ? 'bg-green-500/20 text-green-400' : 'bg-red-500/20 text-red-400'">{{
                                            decision.strategy_direction }}</span>
                                    </div>
                                    <div class="text-xs text-gray-500 mt-1">
                                        Price: ${{ decision.price ? decision.price.toFixed(2) : '0.00' }} | IV: {{
                                        decision.iv ?
                                        (decision.iv * 100).toFixed(0) : '0' }}% | VIX: {{ decision.vix ?
                                        decision.vix.toFixed(1) :
                                        '0.0' }}
                                    </div>
                                </div>

                                <!-- Outcome -->
                                <div class="text-right w-24">
                                    <div class="text-sm font-bold"
                                        :class="decision.outcome_7d > 0 ? 'text-green-400' : 'text-red-400'">
                                        {{ decision.outcome_7d > 0 ? '+' : '' }}{{ decision.outcome_7d ?
                                        decision.outcome_7d.toFixed(2) : '0.00' }}%
                                    </div>
                                    <div class="text-xs text-gray-500">7-day</div>
                                </div>

                                <!-- Regime Badge -->
                                <div class="w-20">
                                    <span class="text-xs px-2 py-1 rounded" :class="{
                                'bg-green-500/20 text-green-400': decision.market_regime === 'BULL_RUN',
                                'bg-red-500/20 text-red-400': decision.market_regime === 'BEAR_CRASH',
                                'bg-gray-500/20 text-gray-400': decision.market_regime === 'SIDEWAYS'
                            }">{{ decision.market_regime }}</span>
                                </div>
                            </div>
                            <div v-if="!backtestHistory || backtestHistory.length === 0"
                                class="text-center text-gray-600 py-8">
                                No historical data yet. Run the backtest script to populate this view.
                            </div>
                        </div>
                    </div>
                </div>

                <!-- TAB 4: LOGIC LOG (BRAIN) -->
                <div v-else-if="activeTab === 'BRAIN'" key="brain"
                    class="h-full flex flex-col bg-black rounded-xl border border-gray-800 p-4 font-mono text-sm overflow-hidden">
                    <div class="text-xs text-green-500 mb-2 border-b border-gray-900 pb-2">root@strategy-lab:~# tail -f
                        brain.log
                    </div>
                    <div class="flex-1 overflow-y-auto space-y-2 text-gray-400 p-2">
                        <div v-for="(log, i) in brainLogs" :key="i" class="border-l-2 border-gray-800 pl-3 py-1">
                            <span class="text-gray-600 text-xs">{{ log.time }}</span> <span :class="log.color">{{
                                log.msg }}</span>
                        </div>
                    </div>
                </div>

            </transition>
        </main>

        <!-- Footer -->
        <footer class="p-4 text-center text-xs text-gray-600 border-t border-gray-900">
            Strategy Lab v2.0 | AI Auto-Pilot Engaged
        </footer>
    </div>

    <script id="strategy-data-script" src="js/strategy_data.js"></script>
    <script src="js/app.js"></script>
</body>

</html>